<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html lang="en"><head>


      <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"><title>The Hypertext&nbsp;Transfer&nbsp;Protocol&nbsp;(HTTP) Entity&nbsp;Tag ("ETag") Response&nbsp;Header in Write&nbsp;Operations</title>
   <style type="text/css" title="Xml2Rfc (sans serif)">
a {
  text-decoration: none;
}
a:hover {
  text-decoration: underline;
}
a:active {
  text-decoration: underline;
}
address {
  margin-top: 1em;
  margin-left: 2em;
  font-style: normal;
}

blockquote {
  border-style: solid;
  border-color: gray;
  border-width: 0 0 0 .25em;
  font-style: italic;
  padding-left: 0.5em;
}

body {
  
  color: #000000;
  font-family: verdana, helvetica, arial, sans-serif;
  font-size: 10pt;
}
cite {
  font-style: normal;
}
dl {
  margin-left: 2em;
}

dl.empty dd {
  margin-top: .5em;
}
dt {
  margin-top: .5em;
}
h1 {
  color: #333333;
  font-size: 14pt;
  line-height: 21pt;
  page-break-after: avoid;
}
h1.np {
  page-break-before: always;
}
h1 a {
  color: #333333;
}
h2 {
  color: #000000;
  font-size: 12pt;
  line-height: 15pt;
  page-break-after: avoid;
}
h2 a {
  color: #000000;
}
h3 {
  color: #000000;
  font-size: 10pt;
  page-break-after: avoid;
}
h3 a {
  color: #000000;
}
h4 {
  color: #000000;
  font-size: 10pt;
  page-break-after: avoid;
}
h4 a {
  color: #000000;
}
h5 {
  color: #000000;
  font-size: 10pt;
  page-break-after: avoid;
}
h5 a {
  color: #000000;
}
img {
  margin-left: 3em;
}
li {
  margin-left: 2em;
  margin-right: 2em;
}
ol {
  margin-left: 2em;
  margin-right: 2em;
}
p {
  margin-left: 2em;
  margin-right: 2em;
}
pre {
  margin-left: 3em;
  background-color: lightyellow;
  padding: .25em;
}
pre.text2 {
  border-style: dotted;
  border-width: 1px;
  background-color: #f0f0f0;
  width: 69em;
}
pre.inline {
  background-color: white;
  padding: 0em;
}
pre.text {
  border-style: dotted;
  border-width: 1px;
  background-color: #f8f8f8;
  width: 69em;
}
pre.drawing {
  border-style: solid;
  border-width: 1px;
  background-color: #f8f8f8;
  padding: 2em;
}

table {
  margin-left: 2em;
}

table.header {
  width: 95%;
  font-size: 10pt;
  color: white;
}
td.top {
  vertical-align: top;
}
td.topnowrap {
  vertical-align: top;
  white-space: nowrap; 
}
td.front {
  background-color: gray;
  width: 50%;
}
thead {
  display:table-header-group;
}
ul.toc {
  list-style: none;
  margin-left: 1.5em;
  margin-right: 0em;
  padding-left: 0em;
}
li.tocline0 {
  line-height: 150%;
  font-weight: bold;
  font-size: 10pt;
  margin-left: 0em;
  margin-right: 0em;
}
li.tocline1 {
  line-height: normal;
  font-weight: normal;
  font-size: 9pt;
  margin-left: 0em;
  margin-right: 0em;
}
li.tocline2 {
  font-size: 0pt;
}
ul.ind {
  list-style: none;
  margin-left: 1.5em;
  margin-right: 0em;
  padding-left: 0em;
}
li.indline0 {
  font-weight: bold;
  line-height: 200%;
  margin-left: 0em;
  margin-right: 0em;
}
li.indline1 {
  font-weight: normal;
  line-height: 150%;
  margin-left: 0em;
  margin-right: 0em;
}

.bcp14 {
  font-style: normal;
  text-transform: lowercase;
  font-variant: small-caps;
}

blockquote > * .bcp14 {
  font-style: italic;
}

.comment {
  background-color: yellow;
}

.center {
  text-align: center;
}
.error {
  font-size: 14pt;
  background-color: red;
}
.figure {
  font-weight: bold;
  text-align: center;
  font-size: 9pt;
}
.filename {
  color: #333333;
  font-weight: bold;
  font-size: 12pt;
  line-height: 21pt;
  text-align: center;
}
.fn {
  font-weight: bold;
}
.hidden {
  display: none;
}
.left {
  text-align: left;
}
.right {
  text-align: right;
}
.title {
  color: #990000;
  font-size: 18pt;
  line-height: 18pt;
  font-weight: bold;
  text-align: center;
  margin-top: 36pt;
}
.vcardline {
  display: block;
}
.warning {
  font-size: 14pt;
  background-color: yellow;
}

table.openissue {
  background-color: khaki;
  border-width: thin;
  border-style: solid;
  border-color: black;
}
table.closedissue {
  background-color: white;
  border-width: thin;
  border-style: solid;
  border-color: gray;
  color: gray; 
}
.bg-issue {
  border: solid;
  border-width: 1px;
  font-size: 7pt;
}
.closed-issue {
  border: solid;
  border-width: thin;
  background-color: lime;
  font-size: smaller;
  font-weight: bold;
}
.open-issue {
  border: solid;
  border-width: thin;
  background-color: red;
  font-size: smaller;
  font-weight: bold;
}
.editor-issue {
  border: solid;
  border-width: thin;
  background-color: yellow;
  font-size: smaller;
  font-weight: bold;
}


@media print {
  .noprint {
    display: none;
  }
  
  table.header {
    width: 90%;
  }

  td.header-l {
    width: 50%;
    color: black;
    background-color: white;
    vertical-align: top;
    font-size: 10pt;
  }

  td.header-r {
    width: 33%;
    color: black;
    background-color: white;
    vertical-align: top;
    text-align: right;
    font-size: 10pt;
  }

  ul.toc a::after {
    content: leader('.') target-counter(attr(href), page);
  }
  
  a.iref {
    content: target-counter(attr(href), page);
  }
  
  .print2col {
    column-count: 2;
    -moz-column-count: 2;
  }
}

@page {
  @top-left {
       content: "INTERNET DRAFT"; 
  } 
  @top-right {
       content: "December 2006"; 
  } 
  @top-center {
       content: "HTTP ETag Header in Write Operations"; 
  } 
  @bottom-left {
       content: "Reschke"; 
  } 
  @bottom-center {
       content: "Experimental"; 
  } 
  @bottom-right {
       content: "[Page " counter(page) "]"; 
  } 
}

@page:first { 
    @top-left {
      content: normal;
    }
    @top-right {
      content: normal;
    }
    @top-center {
      content: normal;
    }
}
</style><link rel="Contents" href="#rfc.toc"><link rel="Author" href="#rfc.authors"><link rel="Copyright" href="#rfc.copyright"><link rel="Chapter" title="1 Introduction" href="#rfc.section.1"><link rel="Chapter" title="2 Notational Conventions" href="#rfc.section.2"><link rel="Chapter" title="3 Clarifications on the Behavior of the 'ETag' Response Header" href="#rfc.section.3"><link rel="Chapter" title="4 The 'Entity-Transform' Header" href="#rfc.section.4"><link rel="Chapter" title="5 How This Helps" href="#rfc.section.5"><link rel="Chapter" title="6 IANA Considerations" href="#rfc.section.6"><link rel="Chapter" title="7 Security Considerations" href="#rfc.section.7"><link rel="Chapter" href="#rfc.section.8" title="8 References"><link rel="Appendix" title="A Use Cases" href="#rfc.section.A"><link rel="Appendix" title="B Change Log (to be removed by RFC Editor before publication)" href="#rfc.section.B"><link rel="up" href="http://greenbytes.de/tech/webdav/#draft-reschke-http-etag-on-write"><link rel="next" href="http://greenbytes.de/tech/webdav/draft-reschke-http-etag-on-write-latest.html"><link rel="prev" href="http://greenbytes.de/tech/webdav/draft-reschke-http-etag-on-write-04.html"><link rel="Start" href="http://greenbytes.de/tech/webdav/#draft-reschke-http-etag-on-write"><link rel="Alternate" title="draft 00" href="http://greenbytes.de/tech/webdav/draft-reschke-http-etag-on-write-00.html"><link rel="Alternate" title="draft 01" href="http://greenbytes.de/tech/webdav/draft-reschke-http-etag-on-write-01.html"><link rel="Alternate" title="draft 02" href="http://greenbytes.de/tech/webdav/draft-reschke-http-etag-on-write-02.html"><link rel="Alternate" title="draft 03" href="http://greenbytes.de/tech/webdav/draft-reschke-http-etag-on-write-03.html"><link rel="Alternate" title="draft 04" href="http://greenbytes.de/tech/webdav/draft-reschke-http-etag-on-write-04.html"><link rel="Alternate" title="(latest)" href="http://greenbytes.de/tech/webdav/draft-reschke-http-etag-on-write-latest.html"><meta name="generator" content="http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.307, 2006/12/16 12:12:10, XSLT vendor: SAXON 6.5.3 from Michael Kay http://saxon.sf.net/"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.Creator" content="Reschke, J. F."><meta name="DC.Identifier" content="urn:ietf:id:draft-reschke-http-etag-on-write-latest"><meta name="DC.Date.Issued" scheme="ISO8601" content="2006-12"><meta name="DC.Description.Abstract" content="The Hypertext Transfer Protocol (HTTP) specifies a state identifier, called &quot;Entity Tag&quot;, to be returned in the &quot;ETag&quot; response header. However, the description of this header for write operations such as PUT is incomplete, and has caused confusion among developers and protocol designers, and potentially interoperability problems. This document explains the problem in detail and suggests both a clarification for a revision to the HTTP/1.1 specification (RFC2616) and a new header for use in responses, making HTTP entity tags more useful for user agents that want to avoid round-trips to the server after modifying a resource."></head><body><table summary="header information" class="header" border="0" cellpadding="1" cellspacing="1"><tbody><tr><td class="front left">Network Working Group</td><td class="front right">J. F. Reschke</td></tr><tr><td class="front left">Internet Draft</td><td class="front right">greenbytes</td></tr><tr><td class="front left">
        &lt;draft-reschke-http-etag-on-write-latest&gt;
      </td><td class="front right">December 2006</td></tr><tr><td class="front left">Updates: <a href="http://tools.ietf.org/html/rfc2616">2616</a> (if approved)</td><td class="front right"></td></tr><tr><td class="front left">Intended status: Experimental</td><td class="front right"></td></tr><tr><td class="front left">Expires: June 2007</td><td class="front right"></td></tr></tbody></table><p class="title">The Hypertext&nbsp;Transfer&nbsp;Protocol&nbsp;(HTTP) Entity&nbsp;Tag ("ETag") Response&nbsp;Header in Write&nbsp;Operations<br><span class="filename">draft-reschke-http-etag-on-write-latest</span></p><h1><a id="rfc.status" href="#rfc.status">Status of this Memo</a></h1><p>By
submitting this Internet-Draft, each author represents that any
applicable patent or other IPR claims of which he or she is aware have
been or will be disclosed, and any of which he or she becomes aware
will be disclosed, in accordance with Section 6 of BCP 79.</p><p>Internet-Drafts
are working documents of the Internet Engineering Task Force (IETF),
its areas, and its working groups. Note that other groups may also
distribute working documents as Internet-Drafts.</p><p>Internet-Drafts
are draft documents valid for a maximum of six months and may be
updated, replaced, or obsoleted by other documents at any time. It is
inappropriate to use Internet-Drafts as reference material or to cite
them other than as &#8220;work in progress&#8221;.</p><p>The list of current Internet-Drafts can be accessed at &lt;<a href="http://www.ietf.org/ietf/1id-abstracts.txt">http://www.ietf.org/ietf/1id-abstracts.txt</a>&gt;.</p><p>The list of Internet-Draft Shadow Directories can be accessed at &lt;<a href="http://www.ietf.org/shadow.html">http://www.ietf.org/shadow.html</a>&gt;.</p><p>This Internet-Draft will expire in June 2007.</p><h1><a id="rfc.copyrightnotice" href="#rfc.copyrightnotice">Copyright Notice</a></h1><p>Copyright © The IETF Trust (2006). All Rights Reserved.</p><h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1> <p>The
Hypertext Transfer Protocol (HTTP) specifies a state identifier, called
"Entity Tag", to be returned in the "ETag" response header. However,
the description of this header for write operations such as PUT is
incomplete, and has caused confusion among developers and protocol
designers, and potentially interoperability problems.</p>  <p>This
document explains the problem in detail and suggests both a
clarification for a revision to the HTTP/1.1 specification (RFC2616)
and a new header for use in responses, making HTTP entity tags more
useful for user agents that want to avoid round-trips to the server
after modifying a resource.</p> <h1 id="rfc.note.1"><a href="#rfc.note.1">Editorial Note (To be removed by RFC Editor before publication)</a></h1> <p>Distribution of this document is unlimited. Please send comments to the Hypertext Transfer Protocol (HTTP) mailing list at <a href="mailto:ietf-http-wg@w3.org">ietf-http-wg@w3.org</a>, which may be joined by sending a message with subject "subscribe" to <a href="mailto:ietf-http-wg-request@w3.org?subject=subscribe">ietf-http-wg-request@w3.org</a>.</p>  <p>Discussions of the HTTP working group are archived at &lt;<a href="http://lists.w3.org/Archives/Public/ietf-http-wg/">http://lists.w3.org/Archives/Public/ietf-http-wg/</a>&gt;.</p>  <p>XML versions, latest edits and the issues list for this document are available from &lt;<a href="http://greenbytes.de/tech/webdav/#draft-reschke-http-etag-on-write-latest">http://greenbytes.de/tech/webdav/#draft-reschke-http-etag-on-write-latest</a>&gt;.</p> <hr class="noprint"><h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1><ul class="toc"><li class="tocline0">1.&nbsp;&nbsp;&nbsp;<a href="#introduction">Introduction</a><ul class="toc"><li class="tocline1">1.1&nbsp;&nbsp;&nbsp;<a href="#rfc.section.1.1">Questions out of Scope</a></li><li class="tocline1">1.2&nbsp;&nbsp;&nbsp;<a href="#problem">The Interoperability Problem</a></li><li class="tocline1">1.3&nbsp;&nbsp;&nbsp;<a href="#rfc2616.definitions">Analysis of RFC2616's Definitions</a></li><li class="tocline1">1.4&nbsp;&nbsp;&nbsp;<a href="#rfc.section.1.4">Prior Work</a></li></ul></li><li class="tocline0">2.&nbsp;&nbsp;&nbsp;<a href="#notational.conventions">Notational Conventions</a></li><li class="tocline0">3.&nbsp;&nbsp;&nbsp;<a href="#clarifications">Clarifications on the Behavior of the 'ETag' Response Header</a></li><li class="tocline0">4.&nbsp;&nbsp;&nbsp;<a href="#header.entity-transform">The 'Entity-Transform' Header</a><ul class="toc"><li class="tocline1">4.1&nbsp;&nbsp;&nbsp;<a href="#rfc.section.4.1">Examples</a></li></ul></li><li class="tocline0">5.&nbsp;&nbsp;&nbsp;<a href="#rfc.section.5">How This Helps</a></li><li class="tocline0">6.&nbsp;&nbsp;&nbsp;<a href="#rfc.section.6">IANA Considerations</a></li><li class="tocline0">7.&nbsp;&nbsp;&nbsp;<a href="#rfc.section.7">Security Considerations</a></li><li class="tocline0">8.&nbsp;&nbsp;&nbsp;<a href="#rfc.references">References</a><ul class="toc"><li class="tocline1">8.1&nbsp;&nbsp;&nbsp;<a href="#rfc.references.1">Normative References</a></li><li class="tocline1">8.2&nbsp;&nbsp;&nbsp;<a href="#rfc.references.2">Informative References</a></li></ul></li><li class="tocline0"><a href="#rfc.authors">Author's Address</a></li><li class="tocline0">A.&nbsp;&nbsp;&nbsp;<a href="#rfc.section.A">Use Cases</a><ul class="toc"><li class="tocline1">A.1&nbsp;&nbsp;&nbsp;<a href="#simple.authoring">Simple Authoring</a></li><li class="tocline1">A.2&nbsp;&nbsp;&nbsp;<a href="#rfc.section.A.2">Simple Authoring, with Entity-Transform header</a></li><li class="tocline1">A.3&nbsp;&nbsp;&nbsp;<a href="#setting.both.content.and.metadata">Setting both Content and Metadata</a></li><li class="tocline1">A.4&nbsp;&nbsp;&nbsp;<a href="#setting.both.content.and.metadata.new.style">Setting both Content and Metadata, new style</a></li></ul></li><li class="tocline0">B.&nbsp;&nbsp;&nbsp;<a href="#rfc.section.B">Change Log (to be removed by RFC Editor before publication)</a><ul class="toc"><li class="tocline1">B.1&nbsp;&nbsp;&nbsp;<a href="#rfc.section.B.1">Since draft-reschke-http-etag-on-write-00</a></li><li class="tocline1">B.2&nbsp;&nbsp;&nbsp;<a href="#rfc.section.B.2">Since draft-reschke-http-etag-on-write-01</a></li><li class="tocline1">B.3&nbsp;&nbsp;&nbsp;<a href="#rfc.section.B.3">Since draft-reschke-http-etag-on-write-02</a></li><li class="tocline1">B.4&nbsp;&nbsp;&nbsp;<a href="#rfc.section.B.4">Since draft-reschke-http-etag-on-write-03</a></li></ul></li><li class="tocline0"><a href="#rfc.ipr">Intellectual Property and Copyright Statements</a></li></ul><h2><a id="rfc.issues-list" href="#rfc.issues-list">Issues list</a></h2><table summary="Issues list"><tbody><tr><td><a href="#rfc.issue.edit">edit</a></td><td>edit</td><td>open</td><td>2006-08-10</td><td><a href="mailto:julian.reschke@greenbytes.de?subject=draft-reschke-http-etag-on-write-latest,%20edit">julian.reschke@greenbytes.de</a></td></tr></tbody></table><table summary="issue edit" class="openissue"><tbody><tr><td colspan="3"><a id="rfc.issue.edit" class="open-issue">&nbsp;I&nbsp;</a>&nbsp;<em>edit</em>
        &nbsp;
        (type: edit, status: open)
      </td></tr><tr><td class="top"><a href="mailto:julian.reschke@greenbytes.de?subject=draft-reschke-http-etag-on-write-latest,%20edit"><i>julian.reschke@greenbytes.de</i></a></td><td class="topnowrap">2006-08-10</td><td class="top">
    Umbrella issue for editorial fixes/enhancements.
  </td></tr></tbody></table><h1 id="rfc.section.1" class="np"><a href="#rfc.section.1">1.</a>&nbsp;<a id="introduction" href="#introduction">Introduction</a></h1><p id="rfc.section.1.p.1">The
Hypertext Transfer Protocol (HTTP) specifies a state identifier, called
"Entity Tag", to be returned in the "ETag" response header (see <a href="#RFC2616"><cite title="Hypertext Transfer Protocol -- HTTP/1.1">[RFC2616]</cite></a>, <a href="http://tools.ietf.org/html/rfc2616#section-14.19">Section 14.19</a>).
However, the description of this header for write operations such as
PUT is incomplete, and has caused confusion among developers and
protocol designers, and potentially interoperability problems.</p><p id="rfc.section.1.p.2">This document explains the problem in detail and suggests both a clarification for a revision to <a href="#RFC2616"><cite title="Hypertext Transfer Protocol -- HTTP/1.1">[RFC2616]</cite></a>
and a new header for use in responses, making HTTP entity tags more
useful for user agents that want to avoid round-trips to the server
after modifying a resource.</p><h2 id="rfc.section.1.1"><a href="#rfc.section.1.1">1.1</a>&nbsp;Questions out of Scope</h2><p id="rfc.section.1.1.p.1">Note
that there is a related problem: modifying content-negotiated
resources. Here the consensus seems to be simply not to do it. Instead,
the origin server should reveal specific URIs of content that is not
content-negotiated in the Content-Location response header (<a href="#RFC2616"><cite title="Hypertext Transfer Protocol -- HTTP/1.1">[RFC2616]</cite></a>, <a href="http://tools.ietf.org/html/rfc2616#section-14.14">Section 14.14</a>),
and user agents should use this more specific URI for authoring. Thus,
the remainder of this document will focus on resources for which no
content negotiation takes place.</p><p id="rfc.section.1.1.p.2">Another related question is the usability of the weak entity tags for authoring (see <a href="#RFC2616"><cite title="Hypertext Transfer Protocol -- HTTP/1.1">[RFC2616]</cite></a>, <a href="http://tools.ietf.org/html/rfc2616#section-13.3.3">Section 13.3.3</a>).
Although this document focuses on the usage of strong entity tags, it
is believed that the changes suggested in this document could be
applied to weak entity tags as well.</p><h2 id="rfc.section.1.2"><a href="#rfc.section.1.2">1.2</a>&nbsp;<a id="problem" href="#problem">The Interoperability Problem</a></h2><p id="rfc.section.1.2.p.1">For a long time, nobody realized that there was a problem at all, or those who realized preferred to ignore it.</p><p id="rfc.section.1.2.p.2">Server
implementers added code that would return the new value of the "ETag"
header in a response to a successful PUT request. After all, the client
could be interested in it.</p><p id="rfc.section.1.2.p.3">User agent
developers in turn were happy to get a new "ETag" value, saving a
subsequent HEAD request to retrieve the new entity tag.</p><p id="rfc.section.1.2.p.4">However, at some point of time, potentially during a Web Distributed Authoring and Versioning (WebDAV, <a href="#RFC2518"><cite title="HTTP Extensions for Distributed Authoring -- WEBDAV">[RFC2518]</cite></a>)
interoperability event, client programmers asked server programmers to
always return "ETag" headers upon PUT, never ever to change the entity
tag without "good reason", and - by the way - always to guarantee that
the server stores the new content octet-by-octet.</p><p id="rfc.section.1.2.p.5">From
the perspective of client software that wants to treat an HTTP server
as a file system replacement, this makes a lot of sense. After all,
when one writes to a file one usually expects the file system to store
what was written, and not to unexpectedly change the contents.</p><p id="rfc.section.1.2.p.6">However,
in general, an HTTP server is not a file system replacement. There may
be some that have been designed that way, and some that expose some
parts of their namespace that have this quality. But in general, HTTP
server implementers have a lot of freedom in how resources are
implemented. Indeed, this flexibility is one of the reasons for HTTP's
success, allowing it to be used for a wide range of tasks, of which
replacing file systems is just one (and not necessarily the most
interesting one).</p><p id="rfc.section.1.2.p.7">In particular: </p><ul><li>A
server may not store a resource as a binary object - in this case, the
representation returned in a subsequent GET request may just be
similar, but not identical to what was written. Good examples are
servers that use HTTP to access XML data (<a href="#XCAP"><cite title="The Extensible Markup Language (XML) Configuration Access Protocol (XCAP)">[XCAP]</cite></a>), Calendaring data (<a href="#CALDAV"><cite title="Calendaring Extensions to WebDAV (CalDAV)">[CALDAV]</cite></a>) or newsfeed data (<a href="#APP"><cite title="The Atom Publishing Protocol">[APP]</cite></a>).</li><li>A
server may change the data being written on purpose, while it is being
written. Examples that immediately come to mind are keyword
substitution in a source control system, or filters that remove
potentially insecure parts out of HTML pages.</li></ul><p id="rfc.section.1.2.p.8">Furthermore: </p><ul><li>An "unrelated" method such as WebDAV's PROPPATCH (see <a href="#RFC2518"><cite title="HTTP Extensions for Distributed Authoring -- WEBDAV">[RFC2518]</cite></a>, <a href="http://tools.ietf.org/html/rfc2518#section-8.2">Section 8.2</a>)
may affect the entity body and therefore the entity tag in an
unexpected way, because the server stores some or all of the WebDAV
properties inside the entity body (for instance, GPS information inside
a JPG image file).</li></ul><p id="rfc.section.1.2.p.9">As long as servers store the content octet-by-octet, and return exactly what the client wrote, there is no problem at all.</p><p id="rfc.section.1.2.p.10">Things get more interesting when a server does change the content, such as in the "simple authoring" example given in <a href="#simple.authoring" title="Simple Authoring">Appendix&nbsp;A.1</a>.
Here, the server does change the content upon writing to the resource,
yet no harm is done, because the final state of the resource on the
server does not depend on the client being aware of that.</p><p id="rfc.section.1.2.p.11">All
of the content rewriting examples mentioned above have this quality:
the client can safely continue to edit the entity it sent, because the
result of the transformation done by the server will be the same in the
end. Formally, if we call the server-side transformation "t", the
initial content "c", and the client-side editing steps "e1" and "e2",
then</p><div id="rfc.figure.u.1"></div> <pre class="text">t(e2(e1(c))) = t(e2(t(e1(c))))
</pre>  <p>e.g., it is irrelevant whether the client obtained the current entity body before doing its second edit.</p> <p id="rfc.section.1.2.p.13"> <span class="comment">[example.for.non.safe.rewrite: 
    Question: does anybody know a real-world example for server-side content
    rewriting where the above is not true? --julian.reschke@greenbytes.de]</span> </p><p id="rfc.section.1.2.p.14">Problems
will only occur if the client uses the entity body it sent, and the
entity tag it obtained in return, in subsequent requests that only
transfer part of the entity body, such as GET or PUT requests using the
"Range" request header (see <a href="#RFC2616"><cite title="Hypertext Transfer Protocol -- HTTP/1.1">[RFC2616]</cite></a>, <a href="http://tools.ietf.org/html/rfc2616#section-14.35">Section 14.35</a>).</p><p id="rfc.section.1.2.p.15">Furthermore,
some clients need to expose the actual contents to the end user. These
clients will have to ensure that they really have the current
representation.</p><p id="rfc.section.1.2.p.16">Entity bodies (and thus
entity tags) changing due to side effects of seemingly unrelated
requests are indeed a problem, as demonstrated in <a href="#setting.both.content.and.metadata" title="Setting both Content and Metadata">Appendix&nbsp;A.3</a>, and this specification proposes a way to resolve this in <a href="#clarifications" title="Clarifications on the Behavior of the 'ETag' Response Header">Section&nbsp;3</a>.</p><h2 id="rfc.section.1.3"><a href="#rfc.section.1.3">1.3</a>&nbsp;<a id="rfc2616.definitions" href="#rfc2616.definitions">Analysis of RFC2616's Definitions</a></h2><p id="rfc.section.1.3.p.1">There are several places in the HTTP/1.1 specification (<a href="#RFC2616"><cite title="Hypertext Transfer Protocol -- HTTP/1.1">[RFC2616]</cite></a>) mentioning the "ETag" response header.</p><p id="rfc.section.1.3.p.2">Let us start with the header definition in <a href="http://tools.ietf.org/html/rfc2616#section-14.19">Section 14.19</a>:</p><blockquote id="rfc.section.1.3.p.3" cite="http://tools.ietf.org/html/rfc2616#section-14.19"> <p>The ETag response-header field provides the current value of the entity tag for the requested variant. Sections <a href="http://tools.ietf.org/html/rfc2616#section-14.24">14.24</a>, <a href="http://tools.ietf.org/html/rfc2616#section-14.26">14.26</a> and <a href="http://tools.ietf.org/html/rfc2616#section-14.44">14.44</a> describe the headers used with entity tags. The entity tag <em class="bcp14">MAY</em> be used for comparison with other entities from the same resource (see Section <a href="http://tools.ietf.org/html/rfc2616#section-13.3.3">13.3.3</a>).</p> </blockquote><p id="rfc.section.1.3.p.4">The meaning of a "response-header" in turn is defined in <a href="http://tools.ietf.org/html/rfc2616#section-6.2">Section 6.2</a>:</p><blockquote id="rfc.section.1.3.p.5" cite="http://tools.ietf.org/html/rfc2616#section-6.2"> <p>The
response-header fields allow the server to pass additional information
about the response which cannot be placed in the Status-Line. These
header fields give information about the server and about further
access to the resource identified by the Request-URI.</p> </blockquote><p id="rfc.section.1.3.p.6">The "ETag" response header itself is mentioned mainly in the context of cache validation, such as in <a href="http://tools.ietf.org/html/rfc2616#section-13.3.2">Section 13.3.2</a>.
What is missing is a coherent description on how the origin server can
notify the user-agent when the entity tag changes as result of a write
operation, such as PUT.</p><p id="rfc.section.1.3.p.7">Indeed, the definition of the 201 Created status code mentions entity tags (<a href="http://tools.ietf.org/html/rfc2616#section-10.2.2">Section 10.2.2</a>):</p><blockquote id="rfc.section.1.3.p.8" cite="http://tools.ietf.org/html/rfc2616#section-10.2.2"> <p>A 201 response <em class="bcp14">MAY</em>
contain an ETag response header field indicating the current value of
the entity tag for the requested variant just created, see Section <a href="http://tools.ietf.org/html/rfc2616#section-14.19">14.19</a>.</p> </blockquote><p id="rfc.section.1.3.p.9">The "ETag" response header is mentioned again in the definition of 206 Partial Content (<a href="http://tools.ietf.org/html/rfc2616#section-10.2.7">Section 10.2.7</a>) and 304 Not Modified (<a href="http://tools.ietf.org/html/rfc2616#section-10.3.5">Section 10.3.5</a>),
but notably missing are statements about other 2xx series status codes
that can occur upon a successful PUT operation, such as 200 OK (<a href="http://tools.ietf.org/html/rfc2616#section-10.2.1">Section 10.2.1</a>) and 204 No Content (<a href="http://tools.ietf.org/html/rfc2616#section-10.2.5">Section 10.2.5</a>).</p><p id="rfc.section.1.3.p.10">Summarizing,
the specification is a bit vague about what an ETag response header
upon a write operation means, but this problem is somewhat mitigated by
the precise definition of a response header. A proposal for enhancing <a href="#RFC2616"><cite title="Hypertext Transfer Protocol -- HTTP/1.1">[RFC2616]</cite></a> in this regard is made in <a href="#clarifications" title="Clarifications on the Behavior of the 'ETag' Response Header">Section&nbsp;3</a> below.</p><h2 id="rfc.section.1.4"><a href="#rfc.section.1.4">1.4</a>&nbsp;Prior Work</h2><p id="rfc.section.1.4.p.1">While working on the revision of <a href="#RFC2518"><cite title="HTTP Extensions for Distributed Authoring -- WEBDAV">[RFC2518]</cite></a>,
the IETF WebDAV working group realized that this is a generic problem
that needs attention independently of WebDAV. An initial attempt was
made with <a href="#draft-whitehead-http-etag"><cite title="Design Considerations for State Identifiers in HTTP and WebDAV">[draft-whitehead-http-etag]</cite></a> in February 2006, but no progress was made since.</p><p id="rfc.section.1.4.p.2">At
the time of this writing in November 2006, two specifications based on
HTTP were either under IESG review or just approved by the IESG, taking
two opposite approaches: </p><ul><li><a href="http://tools.ietf.org/html/draft-ietf-simple-xcap-12#section-8.5">Section 8.5</a> of <a href="#XCAP"><cite title="The Extensible Markup Language (XML) Configuration Access Protocol (XCAP)">[XCAP]</cite></a>
makes it a MUST-level requirement to return an entity tag upon PUT,
even though the very nature of an XCAP server will cause it to rewrite
contents (due to its XML-based storage).</li><li><a href="http://tools.ietf.org/html/draft-dusseault-caldav-15#section-5.3.4">Section 5.3.4</a> of <a href="#CALDAV"><cite title="Calendaring Extensions to WebDAV (CalDAV)">[CALDAV]</cite></a> explicitly forbids ("MUST NOT") returning an entity tag upon PUT if the content was rewritten.</li></ul><p id="rfc.section.1.4.p.3">In
essence, this makes it impossible to implement an HTTP resource that
conforms to both specifications. Due to the differing use cases of XCAP
and CalDAV, this may not be a problem in practice, but the disagreement
in itself is scary. Publication of these specifications on the
standards track will make it much harder for future protocols to deal
with this topic in a meaningful way (comments were sent during IETF
Last Call for CalDAV, see &lt;<a href="http://www1.ietf.org/mail-archive/web/ietf/current/msg43021.html">http://www1.ietf.org/mail-archive/web/ietf/current/msg43021.html</a>&gt;).</p><h1 id="rfc.section.2"><a href="#rfc.section.2">2.</a>&nbsp;<a id="notational.conventions" href="#notational.conventions">Notational Conventions</a></h1><p id="rfc.section.2.p.1">The
key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL-NOT",
"SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
document are to be interpreted as described in <a href="#RFC2119"><cite title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</cite></a>.</p><p id="rfc.section.2.p.2">The terminology used here follows and extends that in the HTTP specification <a href="#RFC2616"><cite title="Hypertext Transfer Protocol -- HTTP/1.1">[RFC2616]</cite></a>, notably the augmented Backus-Naur Form (BNF) defined in <a href="http://tools.ietf.org/html/rfc2616#section-2.1">Section 2.1</a> of that document.</p><h1 id="rfc.section.3"><a href="#rfc.section.3">3.</a>&nbsp;<a id="clarifications" href="#clarifications">Clarifications on the Behavior of the 'ETag' Response Header</a></h1><p id="rfc.section.3.p.1">This section describes a minimal change to <a href="#RFC2616"><cite title="Hypertext Transfer Protocol -- HTTP/1.1">[RFC2616]</cite></a>, proposed in &lt;<a href="http://lists.w3.org/Archives/Public/ietf-http-wg/2006JanMar/0003.html">http://lists.w3.org/Archives/Public/ietf-http-wg/2006JanMar/0003.html</a>&gt;.</p><p id="rfc.section.3.p.2">At the end of <a href="http://tools.ietf.org/html/rfc2616#section-10.2">Section 10.2</a> of <a href="#RFC2616"><cite title="Hypertext Transfer Protocol -- HTTP/1.1">[RFC2616]</cite></a>, add:</p><blockquote id="rfc.section.3.p.3" cite="http://lists.w3.org/Archives/Public/ietf-http-wg/2006JanMar/0003.html"> <p>The response <em class="bcp14">MAY</em> contain an ETag response header field indicating the current value of the entity tag (<a href="http://tools.ietf.org/html/rfc2616#section-14.19">Section 14.19</a>) for the requested variant. The value <em class="bcp14">SHOULD</em> be the same as the one returned upon a subsequent HEAD request addressing the same variant.</p> </blockquote><p id="rfc.section.3.p.4">In <a href="http://tools.ietf.org/html/rfc2616#section-10.2.1">Section 10.2.1</a> of <a href="#RFC2616"><cite title="Hypertext Transfer Protocol -- HTTP/1.1">[RFC2616]</cite></a>, remove:</p><blockquote id="rfc.section.3.p.5" cite="http://lists.w3.org/Archives/Public/ietf-http-wg/2006JanMar/0003.html"> <p>A 201 response <em class="bcp14">MAY</em>
contain an ETag response header field indicating the current value of
the entity tag for the requested variant just created, see <a href="http://tools.ietf.org/html/rfc2616#section-14.19">Section 14.19</a>.</p> </blockquote><p id="rfc.section.3.p.6">In
essence, this moves the statement about entity tags in write operations
from the specific case of status 201 Created into the more generic
description of the 2xx series status codes.</p><p id="rfc.section.3.p.7"> <span class="comment">[rcf2616.enhancements: 
    Should "requested
    variant" be clarified in the context of write operations?
   --julian.reschke@greenbytes.de]</span> </p><h1 id="rfc.section.4"><a href="#rfc.section.4">4.</a>&nbsp;<a id="header.entity-transform" href="#header.entity-transform">The 'Entity-Transform' Header</a></h1><p id="rfc.section.4.p.1">The 'Entity-Transform' entity header provides information about whether a transformation has been applied to an entity body.</p><p id="rfc.section.4.p.2">When
used in an HTTP request, its meaning is undefined. In an HTTP response,
it provides information whether the server has applied a transformation
when the entity was stored last.</p><p id="rfc.section.4.p.3">In
general, entity headers may be stored in intermediates. The main use of
this header however applies to the HTTP PUT method, of which by default
the results are not cacheable (see <a href="#RFC2616"><cite title="Hypertext Transfer Protocol -- HTTP/1.1">[RFC2616]</cite></a>, <a href="http://tools.ietf.org/html/rfc2616#section-9.6">Section 9.6</a>). In addition, the value format is defined so that a client can reliably detect whether the information is fresh.</p><div id="rfc.figure.u.2"></div> <p>Format:</p>  <pre class="inline">Entity-Transform = "Entity-Transform" ":" entity-transform-spec
entity-transform-spec = entity-transform-keyword SP entity-tag
entity-transform-keyword = "identity" | "unspecified"| token

entity-tag = &lt;entity-tag: defined in <a href="#RFC2616"><cite title="Hypertext Transfer Protocol -- HTTP/1.1">[RFC2616]</cite></a>, <a href="http://tools.ietf.org/html/rfc2616#section-3.11">Section 3.11</a>&gt;
token = &lt;token: defined in <a href="#RFC2616"><cite title="Hypertext Transfer Protocol -- HTTP/1.1">[RFC2616]</cite></a>, <a href="http://tools.ietf.org/html/rfc2616#section-2.2">Section 2.2</a>&gt;
</pre><p id="rfc.section.4.p.5">The entity-tag specifies the entity body to which this information applies.</p><p id="rfc.section.4.p.6">An
entity-transform-keyword of "identity" specifies that the origin server
has stored the entity octet-by-octet, thus the user agent <em class="bcp14">MAY</em>
use a local copy of the entity body with the given entity-tag for
subsequent requests that rely on octet-by-octet identity (such as a PUT
with "Range" request header).</p><p id="rfc.section.4.p.7">Both the
absence of this response header and any entity-transform-keyword value
other than "identity" specify that the origin server may have
transformed the entity before storage, thus a subsequent retrieval will
not necessarily return an exact copy of the submitted entity.</p><dl class="empty"><dd>Note: usage of keywords other than "identity" or "unspecified" is reserved for future revisisions of this specification.</dd><dd>Further
note that the definition of the "identity" keyword is independant of
the type of entity-tag. Thus, when "identity" is returned with a weak
entity-tag, the client can indeed rely on octet-by-octet identity.</dd></dl><h2 id="rfc.section.4.1"><a href="#rfc.section.4.1">4.1</a>&nbsp;Examples</h2><div id="rfc.figure.u.3"></div><p>Content was stored octet-by-octet:</p><pre class="text">HTTP/1.1 200 OK
ETag: "1"
Entity-Transform: identity "1"
</pre><div id="rfc.figure.u.4"></div><p>Content was transformed:</p><pre class="text">HTTP/1.1 200 OK
ETag: "2"
Entity-Transform: unspecified "2"
</pre><div id="rfc.figure.u.5"></div><p>Response containing a stale "Entity-Transform" header:</p><pre class="text">HTTP/1.1 200 OK
ETag: "3"
Entity-Transform: unspecified "2"
</pre>  <p>Note that in this case the newly assigned entity tag and the
entity tag returned in "Entity-Transform" do not match, thus the client
is aware that the header value is stale and can't be used.</p> <h1 id="rfc.section.5"><a href="#rfc.section.5">5.</a>&nbsp;How This Helps</h1><p id="rfc.section.5.p.1">The clarification of <a href="#RFC2616"><cite title="Hypertext Transfer Protocol -- HTTP/1.1">[RFC2616]</cite></a> (see <a href="#clarifications" title="Clarifications on the Behavior of the 'ETag' Response Header">Section&nbsp;3</a>)
makes it clear that user agents can use "ETag" headers obtained in
write operations, as long as they do not require octet-by-octet
identity. In particular, a new entity tag can be returned for any
method, such as a WebDAV PROPPATCH (see <a href="#RFC2518"><cite title="HTTP Extensions for Distributed Authoring -- WEBDAV">[RFC2518]</cite></a>, <a href="http://tools.ietf.org/html/rfc2518#section-8.2">Section 8.2</a>). This helps dealing with the problem described in <a href="#setting.both.content.and.metadata" title="Setting both Content and Metadata">Appendix&nbsp;A.3</a>. See <a href="#setting.both.content.and.metadata.new.style" title="Setting both Content and Metadata, new style">Appendix&nbsp;A.4</a> for details.</p><p id="rfc.section.5.p.2">The addition of the "Entity-Transform" header (see <a href="#header.entity-transform" title="The 'Entity-Transform' Header">Section&nbsp;4</a>)
enables origin servers to signal that they stored an exact copy of the
content, thus allowing clients not to refetch the content. Note that by
default (in absence of the response header), a client can not make any
assumptions about the server's behavior in this regard. Thus clients
will only benefit from new servers explicitly setting the new header.</p><h1 id="rfc.section.6"><a href="#rfc.section.6">6.</a>&nbsp;IANA Considerations</h1><p id="rfc.section.6.p.1">This document specifies the new HTTP header listed below.</p><p id="rfc.section.6.p.2"> </p><dl><dt>Header field name:</dt><dd>Entity-Transform</dd><dt>Applicable protocol:</dt><dd>http</dd><dt>Status:</dt><dd>informational</dd><dt>Author/Change controller:</dt><dd>IETF</dd><dt>Specification document:</dt><dd><a href="#header.entity-transform" title="The 'Entity-Transform' Header">Section&nbsp;4</a> of this specification</dd></dl><h1 id="rfc.section.7"><a href="#rfc.section.7">7.</a>&nbsp;Security Considerations</h1><p id="rfc.section.7.p.1">This specification introduces no new security considerations beyond those discussed in <a href="http://tools.ietf.org/html/rfc2616#section-15">Section 15</a> of <a href="#RFC2616"><cite title="Hypertext Transfer Protocol -- HTTP/1.1">[RFC2616]</cite></a>.</p><h1 id="rfc.references"><a id="rfc.section.8" href="#rfc.section.8">8.</a> References</h1><h2 id="rfc.references.1"><a href="#rfc.section.8.1">8.1</a> Normative References</h2><table summary="Normative References" border="0" cellpadding="2">    <tbody><tr><td class="topnowrap"><b id="RFC2119">[RFC2119]</b></td><td class="top"><a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, &#8220;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>&#8221;, BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997.</td></tr><tr><td class="topnowrap"><b id="RFC2616">[RFC2616]</b></td><td class="top"><a href="mailto:fielding@ics.uci.edu" title="University of California, Irvine">Fielding, R.</a>, <a href="mailto:jg@w3.org" title="W3C">Gettys, J.</a>, <a href="mailto:mogul@wrl.dec.com" title="Compaq Computer Corporation">Mogul, J.</a>, <a href="mailto:frystyk@w3.org" title="MIT Laboratory for Computer Science">Frystyk, H.</a>, <a href="mailto:masinter@parc.xerox.com" title="Xerox Corporation">Masinter, L.</a>, <a href="mailto:paulle@microsoft.com" title="Microsoft Corporation">Leach, P.</a>, and <a href="mailto:timbl@w3.org" title="W3C">T. Berners-Lee</a>, &#8220;<a href="http://tools.ietf.org/html/rfc2616">Hypertext Transfer Protocol -- HTTP/1.1</a>&#8221;, RFC&nbsp;2616, June&nbsp;1999.</td></tr></tbody></table><h2 id="rfc.references.2"><a href="#rfc.section.8.2">8.2</a> Informative References</h2><table summary="Informative References" border="0" cellpadding="2">            <tbody><tr><td class="topnowrap"><b id="APP">[APP]</b></td><td class="top"><a href="mailto:joe@bitworking.com" title="BitWorking, Inc">Gregorio, J.C., Ed.</a> and <a href="mailto:bill.dehora@propylon.com" title="Propylon Ltd.">B. de hOra, Ed.</a>, &#8220;<a href="http://tools.ietf.org/html/draft-ietf-atompub-protocol-11">The Atom Publishing Protocol</a>&#8221;, Internet-Draft&nbsp;draft-ietf-atompub-protocol-11 (work in progress), October&nbsp;2006.</td></tr><tr><td class="topnowrap"><b id="CALDAV">[CALDAV]</b></td><td class="top"><a href="mailto:cyrus@daboo.name">Daboo, C.</a>, <a href="mailto:bernard.desruisseaux@oracle.com" title="Oracle Corporation">Desruisseaux, B.</a>, and <a href="mailto:lisa@osafoundation.org" title="      Open Source Application Foundation
    ">L.M. Dusseault</a>, &#8220;<a href="http://tools.ietf.org/html/draft-dusseault-caldav-15">Calendaring Extensions to WebDAV (CalDAV)</a>&#8221;, Internet-Draft&nbsp;draft-dusseault-caldav-15 (work in progress), September&nbsp;2006.</td></tr><tr><td class="topnowrap"><b id="draft-whitehead-http-etag">[draft-whitehead-http-etag]</b></td><td class="top"><a href="mailto:ejw@cse.ucsc.edu" title="UC Santa Cruz, Dept. of Computer Science">Whitehead, J.</a>, &#8220;<a href="http://tools.ietf.org/html/draft-whitehead-http-etag-00">Design Considerations for State Identifiers in HTTP and WebDAV</a>&#8221;, Internet-Draft&nbsp;draft-whitehead-http-etag-00 (work in progress), February&nbsp;2006.<br>(As of November 2006, there didn't appear to be any activity related to this draft.)</td></tr><tr><td class="topnowrap"><b id="HTML">[HTML]</b></td><td class="top"><a href="mailto:dsr@w3.org" title="W3C">Raggett, D.</a>, Hors, A., and I. Jacobs, &#8220;<a href="http://www.w3.org/TR/html401/">HTML 4.01 Specification</a>&#8221;, W3C&nbsp;REC-html401-19991224, December&nbsp;1999, &lt;<a href="http://www.w3.org/TR/html401/">http://www.w3.org/TR/html401/</a>&gt;.</td></tr><tr><td class="topnowrap"><b id="RFC2518">[RFC2518]</b></td><td class="top"><a href="mailto:yarong@microsoft.com" title="Microsoft Corporation">Goland, Y.</a>, <a href="mailto:ejw@ics.uci.edu" title="Dept. Of Information and Computer Science, University of California, Irvine">Whitehead, E.</a>, <a href="mailto:asad@netscape.com" title="Netscape">Faizi, A.</a>, <a href="mailto:srcarter@novell.com" title="Novell">Carter, S.R.</a>, and <a href="mailto:dcjensen@novell.com" title="Novell">D. Jensen</a>, &#8220;<a href="http://tools.ietf.org/html/rfc2518">HTTP Extensions for Distributed Authoring -- WEBDAV</a>&#8221;, RFC&nbsp;2518, February&nbsp;1999.</td></tr><tr><td class="topnowrap"><b id="XCAP">[XCAP]</b></td><td class="top"><a href="mailto:jdrosen@cisco.com" title="Cisco Systems">Rosenberg, J.</a>, &#8220;<a href="http://tools.ietf.org/html/draft-ietf-simple-xcap-12">The Extensible Markup Language (XML) Configuration Access Protocol (XCAP)</a>&#8221;, Internet-Draft&nbsp;draft-ietf-simple-xcap-12 (work in progress), October&nbsp;2006.</td></tr></tbody></table><h1 id="rfc.authors">Author's Address</h1><address class="vcard"><span class="vcardline"><span class="fn">Julian F. Reschke</span><span class="n hidden"><span class="family-name">Reschke</span><span class="given-name">Julian F.</span></span></span><span class="org vcardline">greenbytes GmbH</span><span class="adr"><span class="street-address vcardline">Hafenweg 16</span><span class="vcardline"><span class="locality">Muenster</span>, <span class="region">NW</span>&nbsp;<span class="postal-code">48155</span></span><span class="country-name vcardline">Germany</span></span><span class="vcardline tel">Phone: <a href="tel:+492512807760"><span class="value">+49 251 2807760</span></a></span><span class="vcardline tel"><span class="type">Fax</span>: <a href="fax:+492512807761"><span class="value">+49 251 2807761</span></a></span><span class="vcardline">EMail: <a href="mailto:julian.reschke@greenbytes.de"><span class="email">julian.reschke@greenbytes.de</span></a></span><span class="vcardline">URI: <a href="http://greenbytes.de/tech/webdav/" class="url">http://greenbytes.de/tech/webdav/</a></span></address><h1 id="rfc.section.A"><a href="#rfc.section.A">A.</a>&nbsp;Use Cases</h1><h2 id="rfc.section.A.1"><a href="#rfc.section.A.1">A.1</a>&nbsp;<a id="simple.authoring" href="#simple.authoring">Simple Authoring</a></h2><p id="rfc.section.A.1.p.1">Let
us consider a server not having the quality of preserving
octet-by-octet identity, for instance because of SVN-style keyword
expansion in text content (&lt;<a href="http://svnbook.red-bean.com/en/1.2/svn-book.html#svn.advanced.props.special.keywords">http://svnbook.red-bean.com/en/1.2/svn-book.html#svn.advanced.props.special.keywords</a>&gt;).</p><p id="rfc.section.A.1.p.2">In
this case, the client has previously retrieved the representation for
&lt;http://example.com/test&gt;, and the server has returned the ETag
"1":</p><div id="rfc.figure.u.6"></div> <p>&gt;&gt; Request (1)</p>  <pre class="text2">GET /test HTTP/1.1
Host: example.com</pre> <div id="rfc.figure.u.7"></div> <p>&gt;&gt; Response (1)</p>  <pre class="text">HTTP/1.1 200 OK
Content-Type: text/plain
ETag: "1"

# $Revision: 1 $
Sample text.</pre> <p id="rfc.section.A.1.p.5">The
client now wants to update the resource. To avoid overwriting somebody
else's changes, it submits the PUT request with the HTTP "If-Match"
request header (see <a href="#RFC2616"><cite title="Hypertext Transfer Protocol -- HTTP/1.1">[RFC2616]</cite></a>, <a href="http://tools.ietf.org/html/rfc2616#section-14.24">Section 14.24</a>):</p><div id="rfc.figure.u.8"></div> <p>&gt;&gt; Request (2)</p>  <pre class="text2">PUT /test HTTP/1.1
Host: example.com
If-Match: "1"

# $Revision: 1 $
New sample text.</pre> <p id="rfc.section.A.1.p.7">If the resource was modified in the meantime, the server will reject the request with a 412 Precondition Failed status:</p><div id="rfc.figure.u.9"></div> <p>&gt;&gt; Response (2a)</p>  <pre class="text">HTTP/1.1 412 Precondition Failed
Content-Type: text/plain

Precondition Failed: entity tag supplied in If-Match request header
did not match current.
</pre> <p id="rfc.section.A.1.p.9">In this case, the client usually has
take care of merging the changes made locally with those made on the
server ("Merge Conflict").</p><p id="rfc.section.A.1.p.10">If there was no overlapping update, the server will execute the request and return a new entity tag:</p><div id="rfc.figure.u.10"></div> <p>&gt;&gt; Response (2b)</p>  <pre class="text">HTTP/1.1 200 OK
Content-Type: text/plain
ETag: "2"</pre> <div id="rfc.figure.u.11"></div> <p>Note
however, that at this point the client knows the new entity tag, but
doesn not know the current representation, which will have been updated
by the server to:</p>  <pre class="text"># $Revision: 2 $
New sample text.</pre> <p id="rfc.section.A.1.p.13">What
seems to be a problem at first may not be a real problem in practice.
Let us assume that the client continues editing the resource, using the
entity tag obtained from the previous request, but editing the entity
it last sent:</p><div id="rfc.figure.u.12"></div> <p>&gt;&gt; Request (3)</p>  <pre class="text2">PUT /test HTTP/1.1
Host: example.com
If-Match: "2"

# $Revision: 1 $
A third attempt.</pre> <p id="rfc.section.A.1.p.15">Assuming there was no overlapping update, the PUT request will succeed:</p><div id="rfc.figure.u.13"></div> <p>&gt;&gt; Response (3)</p>  <pre class="text">HTTP/1.1 200 OK
Content-Type: text/plain
ETag: "3"</pre> <p id="rfc.section.A.1.p.17">Note
that the only problem here is that the client doesn't have an exact
copy of the entity it is editing. However, from the server's point of
view this is entirely irrelevant, because the "Revision" keyword will
be automatically updated upon every write anyway.</p><p id="rfc.section.A.1.p.18">In any case, the final contents will be:</p><div id="rfc.figure.u.14"></div> <pre class="text"># $Revision: 3 $
A third attempt.</pre> <h2 id="rfc.section.A.2"><a href="#rfc.section.A.2">A.2</a>&nbsp;Simple Authoring, with Entity-Transform header</h2><p id="rfc.section.A.2.p.1">In the example above (<a href="#simple.authoring" title="Simple Authoring">Appendix&nbsp;A.1</a>,
Response 2b), the server returns an ETag response header upon PUT,
although the content actually was rewritten due to keyword substitution.</p><p id="rfc.section.A.2.p.2">A server implementing this specification would instead respond with:</p><div id="rfc.figure.u.15"></div> <p>&gt;&gt; Response (2c)</p>  <pre class="text">HTTP/1.1 200 OK
Content-Type: text/plain
ETag: "2"
Entity-Transform: unspecified "2"</pre> <p id="rfc.section.A.2.p.4">This
indicates that the content that was sent is not octet-by-octet
identical to what a subsequent GET request would retrieve. It is then
up to the client to decide whether it wants to re-fetch the content
before continuing edits.</p><h2 id="rfc.section.A.3"><a href="#rfc.section.A.3">A.3</a>&nbsp;<a id="setting.both.content.and.metadata" href="#setting.both.content.and.metadata">Setting both Content and Metadata</a></h2><p id="rfc.section.A.3.p.1">In this example, the server exposes data extracted from the HTML &lt;title&gt; element (<a href="#HTML"><cite title="HTML 4.01 Specification">[HTML]</cite></a>, <a href="http://www.w3.org/TR/html401/struct/global.html#h-7.4.2">Section 7.4.2</a>) as a custom WebDAV property (<a href="#RFC2518"><cite title="HTTP Extensions for Distributed Authoring -- WEBDAV">[RFC2518]</cite></a>, <a href="http://tools.ietf.org/html/rfc2518#section-4">Section 4</a>), allowing both read and write access.</p><p id="rfc.section.A.3.p.2">In the first step, the client obtains the current representation for &lt;http://example.com/test.html&gt;:</p><div id="rfc.figure.u.16"></div> <p>&gt;&gt; Request (1)</p>  <pre class="text2">GET /test.html HTTP/1.1
Host: example.com</pre><div id="rfc.figure.u.17"></div> <p>&gt;&gt; Response (1)</p>  <pre class="text">HTTP/1.1 200 OK
Content-Type: text/html
ETag: "A"

&lt;html&gt;
  &lt;head&gt;
  &lt;/head&gt;
  &lt;body&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre><p id="rfc.section.A.3.p.5">Next, it adds one paragraph to the &lt;body&gt; element, and gets back a new entity tag:</p><div id="rfc.figure.u.18"></div> <p>&gt;&gt; Request (2)</p>  <pre class="text2">PUT /test.html HTTP/1.1
Host: example.com
If-Match: "A"

&lt;html&gt;
  &lt;head&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;p&gt;First paragraph.&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre><div id="rfc.figure.u.19"></div> <p>&gt;&gt; Response (2)</p>  <pre class="text">HTTP/1.1 200 OK
ETag: "B"</pre><p id="rfc.section.A.3.p.8">Next, the client sets a custom "title" property (see <a href="#RFC2518"><cite title="HTTP Extensions for Distributed Authoring -- WEBDAV">[RFC2518]</cite></a>, <a href="http://tools.ietf.org/html/rfc2518#section-8.2">Section 8.2</a>):</p><div id="rfc.figure.u.20"></div> <p>&gt;&gt; Request (3)</p>  <pre class="text2">PROPPATCH /test.html HTTP/1.1
Host: example.com
Content-Type: application/xml

&lt;proppatch xmlns="DAV:"&gt;
  &lt;set&gt;
    &lt;prop&gt;
      &lt;title xmlns="http://ns.example.org/"
      &gt;A sample document&lt;/title&gt;
    &lt;/prop&gt;
  &lt;/set&gt;
&lt;/proppatch&gt;</pre><div id="rfc.figure.u.21"></div> <p>&gt;&gt; Response (3)</p>  <pre class="text">HTTP/1.1 207 Multi-Status
Content-Type: application/xml

&lt;multistatus xmlns="DAV:"&gt;
  &lt;response&gt;
    &lt;href&gt;/test.html&lt;/href&gt;
    &lt;propstat&gt;
      &lt;prop&gt;
        &lt;title xmlns="http://ns.example.org/"/&gt;
      &lt;/prop&gt;
      &lt;status&gt;HTTP/1.1 2OO OK&lt;/status&gt;
    &lt;/propstat&gt;
  &lt;/response&gt;
&lt;/multistatus&gt;</pre><p id="rfc.section.A.3.p.11">The
server knows how to propagate property changes into the HTML content,
so it updates the entity by adding an HTML title document accordingly.
This causes the entity tag changing to "C".</p><div id="rfc.figure.u.22"></div> <p>The new entity body is shown below, but the client does not realize that it did change at all.</p>  <pre class="text">&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;A sample document&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;p&gt;First paragraph.&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre> <p id="rfc.section.A.3.p.13">A
subsequent attempt by the client to update the entity body will fail,
unless it realizes that changing WebDAV properties may affect the
entity as well. In this case, it would have had to get the current
entity tag before proceeding. Of course, this introduces an additional
round-trip, and a timing window during which overlapping updates by
other clients would go unnoticed.</p><dl class="empty"><dd>Note that a client would be affected by this behaviour even in the presence of an exclusive WebDAV write lock (see <a href="#RFC2518"><cite title="HTTP Extensions for Distributed Authoring -- WEBDAV">[RFC2518]</cite></a>, <a href="http://tools.ietf.org/html/rfc2518#section-7">Section 7</a>).</dd></dl><h2 id="rfc.section.A.4"><a href="#rfc.section.A.4">A.4</a>&nbsp;<a id="setting.both.content.and.metadata.new.style" href="#setting.both.content.and.metadata.new.style">Setting both Content and Metadata, new style</a></h2><p id="rfc.section.A.4.p.1">Below we repeat the example from above (<a href="#setting.both.content.and.metadata" title="Setting both Content and Metadata">Appendix&nbsp;A.3</a>),
but here the origin server returns entity tags for all write
operations, and the user agent knows how to deal with them. That is,
both take advantage of what <a href="#RFC2616"><cite title="Hypertext Transfer Protocol -- HTTP/1.1">[RFC2616]</cite></a> already allows.</p><div id="rfc.figure.u.23"></div> <p>&gt;&gt; Request (3)</p>  <pre class="text2">PROPPATCH /test.html HTTP/1.1
Host: example.com
Content-Type: application/xml

&lt;proppatch xmlns="DAV:"&gt;
  &lt;set&gt;
    &lt;prop&gt;
      &lt;title xmlns="http://ns.example.org/"&gt;
        A sample document
      &lt;/title&gt;
    &lt;/prop&gt;
  &lt;/set&gt;
&lt;/proppatch&gt;</pre><div id="rfc.figure.u.24"></div> <p>&gt;&gt; Response (3)</p>  <pre class="text">HTTP/1.1 207 Multi-Status
Content-Type: application/xml
ETag: "C"

&lt;multistatus xmlns="DAV:"&gt;
  &lt;response&gt;
    &lt;href&gt;/test.html&lt;/href&gt;
    &lt;propstat&gt;
      &lt;prop&gt;
        &lt;title xmlns="http://ns.example.org/"/&gt;
      &lt;/prop&gt;
      &lt;status&gt;HTTP/1.1 2OO OK&lt;/status&gt;
    &lt;/propstat&gt;
  &lt;/response&gt;
&lt;/multistatus&gt;</pre><p id="rfc.section.A.4.p.4">As
before, this causes the entity to change, and a new entity tag to be
assigned. But in this case, the origin server actually notifies the
client of the changed state by including the "ETag" response header.</p><p id="rfc.section.A.4.p.5">The
client now will be aware that the requested entity change, and can use
the new entity tag in subsequent requests (potentially after refreshing
the local copy).</p><h1 id="rfc.section.B"><a href="#rfc.section.B">B.</a>&nbsp;Change Log (to be removed by RFC Editor before publication)</h1><h2 id="rfc.section.B.1"><a href="#rfc.section.B.1">B.1</a>&nbsp;Since draft-reschke-http-etag-on-write-00</h2><p id="rfc.section.B.1.p.1">Add
and resolves issues "entity-header" and "extensibility", by removing
the extension hooks, and by redefining the header to it can be used as
an Entity header.</p><h2 id="rfc.section.B.2"><a href="#rfc.section.B.2">B.2</a>&nbsp;Since draft-reschke-http-etag-on-write-01</h2><p id="rfc.section.B.2.p.1">Update
APP and CALDAV references. Remove RFC3986 reference (not needed anymore
after the simplication in draft 01). Fix typo in header description
("submitted entity", not "stored entity"). Remove comparison about how
XCAP and CALDAV profile RFC2616: after all, both mandate a behaviour
that was legal but optional before. Add "Updates: RFC2616".</p><h2 id="rfc.section.B.3"><a href="#rfc.section.B.3">B.3</a>&nbsp;Since draft-reschke-http-etag-on-write-02</h2><p id="rfc.section.B.3.p.1">In
the references, note that there was no activitiy on
draft-whitehead-http-etag-00 anymore. Change intended status to
"Experimental". Update APP reference. Update statements about current
status of XCAP and CALDAV. Add and resolve "clarify-extension".</p><h2 id="rfc.section.B.4"><a href="#rfc.section.B.4">B.4</a>&nbsp;Since draft-reschke-http-etag-on-write-03</h2><p id="rfc.section.B.4.p.1">Update
XCAP reference. Update header definition to use prose rules rather than
comments. Clarify "identity" keyword when appearing with a weak
entity-tag. In PROPPATCH/HTML example, fix whitespace so that the HTML
title element has exactly the same value as the one that was
PROPPATCHed. Mention that ETags changing due to a PROPPATCH could even
occur in presence of a WebDAV write lock. Expand keyword substitution
example with variant where Entity-Transform is returned.</p><h1><a id="rfc.copyright" href="#rfc.copyright">Full Copyright Statement</a></h1><p>Copyright © The IETF Trust (2006).</p><p>This
document is subject to the rights, licenses and restrictions contained
in BCP 78, and except as set forth therein, the authors retain all
their rights.</p><p>This document and the information contained herein
are provided on an &#8220;AS IS&#8221; basis and THE CONTRIBUTOR, THE ORGANIZATION
HE/SHE REPRESENTS OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY,
THE IETF TRUST AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL
WARRANTIES, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY
WARRANTY THAT THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY
RIGHTS OR ANY IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A
PARTICULAR PURPOSE.</p><h1><a id="rfc.ipr" href="#rfc.ipr">Intellectual Property</a></h1><p>The
IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed to
pertain to the implementation or use of the technology described in
this document or the extent to which any license under such rights
might or might not be available; nor does it represent that it has made
any independent effort to identify any such rights. Information on the
procedures with respect to rights in RFC documents can be found in BCP
78 and BCP 79.</p><p>Copies of IPR disclosures made to the IETF
Secretariat and any assurances of licenses to be made available, or the
result of an attempt made to obtain a general license or permission for
the use of such proprietary rights by implementers or users of this
specification can be obtained from the IETF on-line IPR repository at
&lt;<a href="http://www.ietf.org/ipr">http://www.ietf.org/ipr</a>&gt;.</p><p>The
IETF invites any interested party to bring to its attention any
copyrights, patents or patent applications, or other proprietary rights
that may cover technology that may be required to implement this
standard. Please address the information to the IETF at <a href="mailto:ietf-ipr@ietf.org">ietf-ipr@ietf.org</a>.</p><h1>Acknowledgement</h1><p>Funding for the RFC Editor function is provided by the IETF Administrative Support Activity (IASA).</p></body></html>